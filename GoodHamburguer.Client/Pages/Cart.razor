@page "/cart"

<PageTitle>GoodHamburguer - Cart</PageTitle>

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2>Shopping Cart</h2>
        </div>
    </div>

    <ErrorMessage Message="@ErrorMessage" OnDismiss="ClearError" />

    @if (IsLoading)
    {
        <LoadingSpinner />
    }
    else if (CurrentCart != null && CurrentCart.Items.Any())
    {
        <div class="row">
            <div class="col-lg-8 col-md-12 mb-4 mb-lg-0">
                <div class="card cart-items-card">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Cart Items</h5>
                        @foreach (var item in CurrentCart.Items)
                        {
                            <div class="cart-item">
                                <div class="cart-item-info">
                                    <span class="cart-item-name">@item.ProductName</span>
                                    <span class="cart-item-meta">@item.UnitPrice.ToString("C") each</span>
                                </div>
                                <div class="quantity-control" role="group" aria-label="Quantity controls for @item.ProductName">
                                    <button class="quantity-btn" type="button" @onclick="() => UpdateQuantity(item.ProductId, item.Quantity - 1)" disabled="@IsUpdating">
                                        <span class="visually-hidden">Decrease quantity</span>
                                        <span aria-hidden="true">âˆ’</span>
                                    </button>
                                    <span class="quantity-value">@item.Quantity</span>
                                    <button class="quantity-btn" type="button" @onclick="() => UpdateQuantity(item.ProductId, item.Quantity + 1)" disabled="@IsUpdating">
                                        <span class="visually-hidden">Increase quantity</span>
                                        <span aria-hidden="true">+</span>
                                    </button>
                                </div>
                                <div class="cart-item-total text-sm-end">
                                    <span class="cart-item-total-label">Subtotal</span>
                                    <strong>@item.Subtotal.ToString("C")</strong>
                                </div>
                                <button class="btn btn-outline-danger cart-remove-btn" type="button" @onclick="() => RemoveItem(item.ProductId)" disabled="@IsRemoving">
                                    Remove
                                </button>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-12">
                <div class="card cart-summary-card">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Summary</h5>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span>@CurrentCart.Subtotal.ToString("C")</span>
                        </div>
                        @if (CurrentCart.DiscountAmount.HasValue && CurrentCart.DiscountAmount > 0)
                        {
                            <div class="d-flex justify-content-between mb-2 text-success">
                                <span>Discount (@CurrentCart.AppliedDiscountName):</span>
                                <span>-@CurrentCart.DiscountAmount.Value.ToString("C")</span>
                            </div>
                        }
                        <hr />
                        <div class="d-flex justify-content-between mb-4">
                            <strong>Total:</strong>
                            <strong>@CurrentCart.Total.ToString("C")</strong>
                        </div>
                        <button class="btn btn-primary w-100" @onclick="HandleCheckout" disabled="@IsCheckingOut">
                            @if (IsCheckingOut)
                            {
                                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                            }
                            Checkout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
    else if (!IsLoading)
    {
        <div class="alert alert-info">
            <h5>Empty Cart</h5>
            <p>Add products to your cart to continue.</p>
            <a href="/products" class="btn btn-primary">View Products</a>
        </div>
    }
</div>
