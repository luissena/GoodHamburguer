@page "/cart"

<PageTitle>GoodHamburguer - Cart</PageTitle>

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2>Shopping Cart</h2>
        </div>
    </div>

    <ErrorMessage Message="@ErrorMessage" OnDismiss="ClearError" />

    @if (IsLoading)
    {
        <LoadingSpinner />
    }
    else if (CurrentCart != null && CurrentCart.Items.Any())
    {
        <div class="row">
            <div class="col-lg-8 col-md-12 mb-4 mb-lg-0">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Cart Items</h5>
                        @foreach (var item in CurrentCart.Items)
                        {
                            <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-3 pb-3 border-bottom">
                                <div class="flex-grow-1 mb-2 mb-sm-0">
                                    <h6 class="mb-1">@item.ProductName</h6>
                                    <p class="text-muted mb-0">@item.UnitPrice.ToString("C") each</p>
                                </div>
                                <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center gap-2 w-100 w-sm-auto">
                                    <div class="input-group" style="max-width: 150px; width: 100%;">
                                        <button class="btn btn-outline-secondary btn-sm" type="button" @onclick="() => UpdateQuantity(item.ProductId, item.Quantity - 1)" disabled="@IsUpdating">-</button>
                                        <input type="number" class="form-control text-center" value="@item.Quantity" readonly />
                                        <button class="btn btn-outline-secondary btn-sm" type="button" @onclick="() => UpdateQuantity(item.ProductId, item.Quantity + 1)" disabled="@IsUpdating">+</button>
                                    </div>
                                    <div class="text-start text-sm-end" style="min-width: 100px;">
                                        <strong>@item.Subtotal.ToString("C")</strong>
                                    </div>
                                    <button class="btn btn-outline-danger btn-sm" @onclick="() => RemoveItem(item.ProductId)" disabled="@IsRemoving">
                                        Remove
                                    </button>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-12">
                <div class="card sticky-top" style="top: 80px;">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Summary</h5>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span>@CurrentCart.Subtotal.ToString("C")</span>
                        </div>
                        @if (CurrentCart.DiscountAmount.HasValue && CurrentCart.DiscountAmount > 0)
                        {
                            <div class="d-flex justify-content-between mb-2 text-success">
                                <span>Discount (@CurrentCart.AppliedDiscountName):</span>
                                <span>-@CurrentCart.DiscountAmount.Value.ToString("C")</span>
                            </div>
                        }
                        <hr />
                        <div class="d-flex justify-content-between mb-4">
                            <strong>Total:</strong>
                            <strong>@CurrentCart.Total.ToString("C")</strong>
                        </div>
                        <button class="btn btn-primary w-100" @onclick="HandleCheckout" disabled="@IsCheckingOut">
                            @if (IsCheckingOut)
                            {
                                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                            }
                            Checkout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
    else if (!IsLoading)
    {
        <div class="alert alert-info">
            <h5>Empty Cart</h5>
            <p>Add products to your cart to continue.</p>
            <a href="/products" class="btn btn-primary">View Products</a>
        </div>
    }
</div>
